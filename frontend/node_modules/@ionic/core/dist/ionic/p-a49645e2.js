/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */
import{g as o,c as n,f as t}from"./p-b01a9a1a.js";import{a as i,b as e,r as a,c as r}from"./p-504842aa.js";import{w as s}from"./p-4de71892.js";import"./p-e1bc9a81.js";var d;!function(o){o.Body="body",o.Ionic="ionic",o.Native="native",o.None="none"}(d||(d={}));const c={getEngine(){var o;return(null===(o=null==s?void 0:s.Capacitor)||void 0===o?void 0:o.isPluginAvailable("Keyboard"))&&(null==s?void 0:s.Capacitor.Plugins.Keyboard)},getResizeMode(){const o=this.getEngine();return o&&o.getResizeMode?o.getResizeMode():Promise.resolve(void 0)}},l=new WeakMap,u=(o,n,t,i=0,e=!1)=>{l.has(o)!==t&&(t?f(o,n,i,e):w(o,n))},f=(o,n,t,i=!1)=>{const e=n.parentNode,a=n.cloneNode(!1);a.classList.add("cloned-input"),a.tabIndex=-1,i&&(a.disabled=!0),e.appendChild(a),l.set(o,a);const r="rtl"===o.ownerDocument.dir?9999:-9999;o.style.pointerEvents="none",n.style.transform=`translate3d(${r}px,${t}px,0) scale(0)`},w=(o,n)=>{const t=l.get(o);t&&(l.delete(o),t.remove()),o.style.pointerEvents="",n.style.transform=""},p="input, textarea, [no-blur], [contenteditable]",m="$ionPaddingTimer",b=(o,n,t)=>{const i=o[m];i&&clearTimeout(i),n>0?o.style.setProperty("--keyboard-offset",`${n}px`):o[m]=setTimeout((()=>{o.style.setProperty("--keyboard-offset","0px"),t&&t()}),120)},y=(o,n,t)=>{o.addEventListener("focusout",(()=>{n&&b(n,0,t)}),{once:!0})};let h=0;const v="data-ionic-skip-scroll-assist",S=o=>{document.activeElement!==o&&(o.setAttribute(v,"true"),o.focus())},M=async(t,i,e,r,s,d,c=!1)=>{if(!e&&!r)return;const l=((o,n,t)=>{var i;return((o,n,t,i)=>{const e=o.top,a=o.bottom,r=n.top,s=r+15,d=Math.min(n.bottom,i-t)-50-a,c=s-e,l=Math.round(d<0?-d:c>0?-c:0),u=Math.min(l,e-r),f=Math.abs(u);return{scrollAmount:u,scrollDuration:Math.min(400,Math.max(150,f/.3)),scrollPadding:t,inputSafeY:4-(e-s)}})((null!==(i=o.closest("ion-item,[ion-item]"))&&void 0!==i?i:o).getBoundingClientRect(),n.getBoundingClientRect(),t,o.ownerDocument.defaultView.innerHeight)})(t,e||r,s);if(e&&Math.abs(l.scrollAmount)<4)return S(i),void(d&&null!==e&&(b(e,h),y(i,e,(()=>h=0))));if(u(t,i,!0,l.inputSafeY,c),S(i),a((()=>t.click())),d&&e&&(h=l.scrollPadding,b(e,h)),"undefined"!=typeof window){let a;const r=async()=>{void 0!==a&&clearTimeout(a),window.removeEventListener("ionKeyboardDidShow",s),window.removeEventListener("ionKeyboardDidShow",r),e&&await n(e,0,l.scrollAmount,l.scrollDuration),u(t,i,!1,l.inputSafeY),S(i),d&&y(i,e,(()=>h=0))},s=()=>{window.removeEventListener("ionKeyboardDidShow",s),window.addEventListener("ionKeyboardDidShow",r)};if(e){const n=await o(e);if(l.scrollAmount>n.scrollHeight-n.clientHeight-n.scrollTop)return"password"===i.type?(l.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",s)):window.addEventListener("ionKeyboardDidShow",r),void(a=setTimeout(r,1e3))}r()}},g=async(o,n)=>{const a=document,s="ios"===n,l="android"===n,f=o.getNumber("keyboardHeight",290),w=o.getBoolean("scrollAssist",!0),m=o.getBoolean("hideCaretOnScroll",s),b=o.getBoolean("inputBlurring",s),y=o.getBoolean("scrollPadding",!0),h=Array.from(a.querySelectorAll("ion-input, ion-textarea")),S=new WeakMap,g=new WeakMap,D=await c.getResizeMode(),x=async o=>{await new Promise((n=>r(o,n)));const n=o.shadowRoot||o,a=n.querySelector("input")||n.querySelector("textarea"),s=t(o),c=s?null:o.closest("ion-footer");if(a){if(s&&m&&!S.has(o)){const n=((o,n,t)=>{if(!t||!n)return()=>{};const a=t=>{var i;(i=n)===i.getRootNode().activeElement&&u(o,n,t)},r=()=>u(o,n,!1),s=()=>a(!0),d=()=>a(!1);return i(t,"ionScrollStart",s),i(t,"ionScrollEnd",d),n.addEventListener("blur",r),()=>{e(t,"ionScrollStart",s),e(t,"ionScrollEnd",d),n.removeEventListener("blur",r)}})(o,a,s);S.set(o,n)}if("date"!==a.type&&"datetime-local"!==a.type&&(s||c)&&w&&!g.has(o)){const n=((o,n,t,i,e,a,r,s=!1)=>{const c=a&&(void 0===r||r.mode===d.None),l=async()=>{n.hasAttribute(v)?n.removeAttribute(v):M(o,n,t,i,e,c,s)};return o.addEventListener("focusin",l,!0),()=>{o.removeEventListener("focusin",l,!0)}})(o,a,s,c,f,y,D,l);g.set(o,n)}}};b&&(()=>{let o=!0,n=!1;const t=document;i(t,"ionScrollStart",(()=>{n=!0})),t.addEventListener("focusin",(()=>{o=!0}),!0),t.addEventListener("touchend",(i=>{if(n)return void(n=!1);const e=t.activeElement;if(!e)return;if(e.matches(p))return;const a=i.target;a!==e&&(a.matches(p)||a.closest(p)||(o=!1,setTimeout((()=>{o||e.blur()}),50)))}),!1)})();for(const o of h)x(o);a.addEventListener("ionInputDidLoad",(o=>{x(o.detail)})),a.addEventListener("ionInputDidUnload",(o=>{(o=>{if(m){const n=S.get(o);n&&n(),S.delete(o)}if(w){const n=g.get(o);n&&n(),g.delete(o)}})(o.detail)}))};export{g as startInputShims}